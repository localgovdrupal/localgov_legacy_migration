langcode: en
status: true
dependencies:
  module:
    - localgov_directories_page
id: geo_address
migration_group: localgov_directories
label: 'Geo - address'
source:
  plugin: d8_entity
  key: migration
  entity_type: node
  bundle: directory_item
  track_changes: true
process:
  # Process directory entries with Geofield data into LocalGov Geo address entities.
  location:
    -
      plugin: skip_row_if_not_set
      index: 0
      source: field_geofield
    -
      plugin: fix_lat_lon_order
    -
      plugin: geo_location_to_field
  uid: uid
  status:
    - plugin: default_value
      default_value: true
  created: created
  changed: changed
  langcode: langcode
  accessibility: 
    plugin: sub_process
    source: field_accessibility_text
    process:
      value: value
      format:
        plugin: static_map
        source: format
        default_value: editor
        map:
          'wysiwyg': unrestricted
          'editor': editor
      summary: summary
  postal_address:
    plugin: sub_process
    source: field_addressfield
    process:
      country_code:
        plugin: default_value
        default_value: GB
      address_line1: street
      locality: city
      postal_code: postcode
destination:
  plugin: 'entity:localgov_geo'
  default_bundle: address
migration_dependencies:
  required:
    - directory_channel
  optional:
    - users
